<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Elasticsearch篇之Mapping设置 | Jiavg</title><meta name="description" content="Elasticsearch篇之Mapping设置"><meta name="keywords" content="ElasticSearch,Mapping"><meta name="author" content="Jiavg"><meta name="copyright" content="Jiavg"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Elasticsearch篇之Mapping设置"><meta name="twitter:description" content="Elasticsearch篇之Mapping设置"><meta name="twitter:image" content="https://jiavag.github.io/img/bg/18.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Elasticsearch篇之Mapping设置"><meta property="og:url" content="https://jiavag.github.io/2020/04/09/Elastic%20Search/%E7%AC%AC4%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BMapping%E8%AE%BE%E7%BD%AE/"><meta property="og:site_name" content="Jiavg"><meta property="og:description" content="Elasticsearch篇之Mapping设置"><meta property="og:image" content="https://jiavag.github.io/img/bg/18.jpg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://jiavag.github.io/2020/04/09/Elastic%20Search/%E7%AC%AC4%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BMapping%E8%AE%BE%E7%BD%AE/"><link rel="prev" title="Elasticsearch篇之Search API" href="https://jiavag.github.io/2020/04/09/Elastic%20Search/%E7%AC%AC5%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BSearch%20API/"><link rel="next" title="Elasticsearch篇之倒排索引与分词" href="https://jiavag.github.io/2020/04/08/Elastic%20Search/%E7%AC%AC3%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%88%86%E8%AF%8D/"><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-6386517046719934',
  enable_page_level_ads: 'true'
});</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.lylgjiavg.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: Jiavg","link":"链接: ","source":"来源: Jiavg","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'true',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Elasticsearch篇之Mapping设置"><span class="toc-number">1.</span> <span class="toc-text">Elasticsearch篇之Mapping设置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Mapping简介"><span class="toc-number">1.1.</span> <span class="toc-text">Mapping简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义Mapping"><span class="toc-number">1.2.</span> <span class="toc-text">自定义Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic"><span class="toc-number">1.2.1.</span> <span class="toc-text">dynamic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#copy-to"><span class="toc-number">1.2.2.</span> <span class="toc-text">copy_to</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index"><span class="toc-number">1.2.3.</span> <span class="toc-text">index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index-options"><span class="toc-number">1.2.4.</span> <span class="toc-text">index_options</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null-value"><span class="toc-number">1.2.5.</span> <span class="toc-text">null_value</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapping文档说明"><span class="toc-number">1.2.6.</span> <span class="toc-text">mapping文档说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据类型"><span class="toc-number">1.3.</span> <span class="toc-text">数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#核心数据类型"><span class="toc-number">1.3.1.</span> <span class="toc-text">核心数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复杂数据类型"><span class="toc-number">1.3.2.</span> <span class="toc-text">复杂数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地理位置数据类型"><span class="toc-number">1.3.3.</span> <span class="toc-text">地理位置数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#专用类型"><span class="toc-number">1.3.4.</span> <span class="toc-text">专用类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多字段特性"><span class="toc-number">1.3.5.</span> <span class="toc-text">多字段特性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dynamic-Mapping"><span class="toc-number">1.4.</span> <span class="toc-text">Dynamic Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自动识别支持类型"><span class="toc-number">1.4.1.</span> <span class="toc-text">自动识别支持类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#日期的自动识别"><span class="toc-number">1.4.2.</span> <span class="toc-text">日期的自动识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符串中数字的自动识别"><span class="toc-number">1.4.3.</span> <span class="toc-text">字符串中数字的自动识别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dynamic-Templates"><span class="toc-number">1.5.</span> <span class="toc-text">Dynamic Templates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dynamic-Templates-设置示例"><span class="toc-number">1.5.1.</span> <span class="toc-text">Dynamic Templates 设置示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义Mapping建议"><span class="toc-number">1.6.</span> <span class="toc-text">自定义Mapping建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引模板"><span class="toc-number">1.7.</span> <span class="toc-text">索引模板</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/img/bg/18.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Jiavg</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 清单</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Elasticsearch篇之Mapping设置</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-04-09 00:18:34"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-04-09</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-04-15 01:25:45"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-04-15</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Elastic-Stack/">Elastic Stack</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="Elasticsearch篇之Mapping设置"><a href="#Elasticsearch篇之Mapping设置" class="headerlink" title="Elasticsearch篇之Mapping设置"></a>Elasticsearch篇之Mapping设置</h1><h2 id="Mapping简介"><a href="#Mapping简介" class="headerlink" title="Mapping简介"></a>Mapping简介</h2><ul>
<li><p>mapping类似于数据库中的表结构定义,主要的作用如下</p>
<ul>
<li>定义Index下的字段名 (Field Name)</li>
<li>定义字段的类型, 比如数值型, 字符串型, 布尔型等</li>
<li>定义倒排索引相关的配置, 比如是否索引, 记录position等</li>
</ul>
</li>
<li><p>获得索引的mapping设置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#123;索引名&#125;/_mapping</span><br></pre></td></tr></table></figure>

<p>示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line">GET test_index/_mapping</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line">&#123;</span><br><span class="line">  "test_index": &#123;			# 索引名</span><br><span class="line">    "mappings": &#123;</span><br><span class="line">      "doc": &#123;				# 类型名</span><br><span class="line">        "properties": &#123;		# 里面包含字段的详细信息</span><br><span class="line">          "age": &#123;</span><br><span class="line">            "type": "long"</span><br><span class="line">          &#125;,</span><br><span class="line">          "username": &#123;</span><br><span class="line">            "type": "text",</span><br><span class="line">            "fields": &#123;</span><br><span class="line">              "keyword": &#123;</span><br><span class="line">                "type": "keyword",</span><br><span class="line">                "ignore_above": 256</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="自定义Mapping"><a href="#自定义Mapping" class="headerlink" title="自定义Mapping"></a>自定义Mapping</h2><ul>
<li><p>自定义Mapping API</p>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/RM8cLg36zSnk5Y4.jpg"  alt="2020-04-09_003335"></p>
</li>
<li><p>Mapping中的字段类型一旦设定后, 禁止直接修改, 原因如下</p>
<ul>
<li>Lucene实现的倒排索引生成后不允许修改</li>
</ul>
</li>
<li><p>如果需要修改, 重新建立新的索引, 然后做reindex操作</p>
</li>
<li><p>允许新增字段</p>
</li>
</ul>
<h3 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h3><ul>
<li><p>通过dynamic参数来控制字段的新增</p>
</li>
<li><p>true (默认) 允许自动新增字段</p>
</li>
<li><p>false 不允许自动新增字段, 但是文档可以正常写入, 但无法对字段进行查询等操作</p>
</li>
<li><p>strict 文档不能写入, 报错</p>
</li>
</ul>
<p>设置dynamic参数方式如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line">PUT test_index3</span><br><span class="line">&#123;</span><br><span class="line">  "mappings": &#123;</span><br><span class="line">    "doc": &#123;</span><br><span class="line">      "dynamic": false,			# 设置不允许自动新增字段 (全局)</span><br><span class="line">      "properties": &#123;</span><br><span class="line">        "user": &#123;</span><br><span class="line">          "type": "keyword"</span><br><span class="line">        &#125;,</span><br><span class="line">        "social_networks": &#123;</span><br><span class="line">          "dynamic": true,		# 设置social_networks字段可以自增字段 (局部)</span><br><span class="line">          "properties": &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在对test_index3进行新增文档后, 查看字段自增情况</span></span><br><span class="line">PUT test_index3/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  "user": "jiavg",</span><br><span class="line">  "pwd": "123456",</span><br><span class="line">  "age": 23,					# 新增了一个字段(全局)</span><br><span class="line">  "social_networks": &#123;</span><br><span class="line">    "cookie": "user-agent"		# 新增了一个字段(social_networks局部)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看索引mapping设置</span></span><br><span class="line">GET test_index3/_mapping</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可见全局由于设置 <span class="string">"dynamic"</span>: <span class="literal">false</span>, age字段没有自动添加到索引的mapping中去</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 而由于<span class="string">"social_networks"</span>局部设置 <span class="string">"dynamic"</span>: <span class="literal">true</span>, cookie字段自动添加到了索引的mapping中去</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其中,不仅仅是mapping设置发生改变, 新增的cookie字段可以由es query进行查询, 而age则不可以</span></span><br><span class="line">&#123;</span><br><span class="line">  "test_index3": &#123;</span><br><span class="line">    "mappings": &#123;</span><br><span class="line">      "doc": &#123;</span><br><span class="line">        "dynamic": "false",</span><br><span class="line">        "properties": &#123;</span><br><span class="line">          "social_networks": &#123;</span><br><span class="line">            "dynamic": "true",</span><br><span class="line">            "properties": &#123;</span><br><span class="line">              "cookie": &#123;</span><br><span class="line">                "type": "text",</span><br><span class="line">                "fields": &#123;</span><br><span class="line">                  "keyword": &#123;</span><br><span class="line">                    "type": "keyword",</span><br><span class="line">                    "ignore_above": 256</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          "user": &#123;</span><br><span class="line">            "type": "keyword"</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="copy-to"><a href="#copy-to" class="headerlink" title="copy_to"></a>copy_to</h3><ul>
<li>将该字段的值复制到目标字段, 实现类似<code>_all</code>的作用</li>
<li>不会出现在<code>_source</code>中, 只用来搜索</li>
</ul>
<p>示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> copy_to使用示例</span></span><br><span class="line">PUT test_index4</span><br><span class="line">&#123;</span><br><span class="line">  "mappings": &#123;</span><br><span class="line">    "doc": &#123;</span><br><span class="line">      "properties": &#123;</span><br><span class="line">        "first-name": &#123;</span><br><span class="line">          "type": "text",</span><br><span class="line">          "copy_to": "full-name"	# 把该字段复制到"full-name"字段</span><br><span class="line">        &#125;,</span><br><span class="line">        "last-name": &#123;</span><br><span class="line">          "type": "text",</span><br><span class="line">          "copy_to": "full-name"	# 把该字段复制到"full-name"字段</span><br><span class="line">        &#125;,</span><br><span class="line">        "full-name": &#123;				# 目标字段</span><br><span class="line">          "type": "text"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 插入文档数据到test_index4索引</span></span><br><span class="line">PUT test_index4/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  "first-name": "jike",</span><br><span class="line">  "last-name": "shijian"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看test_index4索引的文档信息</span></span><br><span class="line">GET test_index4/_search</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由结果可见, 复制的目标字段(<span class="string">"full-name"</span>)并没有出现在_source中</span></span><br><span class="line">&#123;</span><br><span class="line">  "took": 1,</span><br><span class="line">  "timed_out": false,</span><br><span class="line">  "_shards": &#123;</span><br><span class="line">    "total": 5,</span><br><span class="line">    "successful": 5,</span><br><span class="line">    "skipped": 0,</span><br><span class="line">    "failed": 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits": &#123;</span><br><span class="line">    "total": 1,</span><br><span class="line">    "max_score": 1,</span><br><span class="line">    "hits": [</span><br><span class="line">      &#123;</span><br><span class="line">        "_index": "test_index4",</span><br><span class="line">        "_type": "doc",</span><br><span class="line">        "_id": "1",</span><br><span class="line">        "_score": 1,</span><br><span class="line">        "_source": &#123;</span><br><span class="line">          "first-name": "jike",</span><br><span class="line">          "last-name": "shijian"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对test_index4索引的<span class="string">"full-name"</span>字段进行查询</span></span><br><span class="line">GET test_index4/_search</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "match": &#123;</span><br><span class="line">      "full-name": &#123;</span><br><span class="line">        "query": "jike shijian",</span><br><span class="line">        "operator": "and"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由查询结果, 根据<span class="string">"full-name"</span>字段可以查询到文档数据</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可见虽然copy_to的目标字段数据虽然不会存储到_source中, 但是却可以根据此字段进行查询</span></span><br><span class="line">&#123;</span><br><span class="line">  "took": 4,</span><br><span class="line">  "timed_out": false,</span><br><span class="line">  "_shards": &#123;</span><br><span class="line">    "total": 5,</span><br><span class="line">    "successful": 5,</span><br><span class="line">    "skipped": 0,</span><br><span class="line">    "failed": 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits": &#123;</span><br><span class="line">    "total": 1,</span><br><span class="line">    "max_score": 0.5753642,</span><br><span class="line">    "hits": [</span><br><span class="line">      &#123;</span><br><span class="line">        "_index": "test_index4",</span><br><span class="line">        "_type": "doc",</span><br><span class="line">        "_id": "1",</span><br><span class="line">        "_score": 0.5753642,</span><br><span class="line">        "_source": &#123;</span><br><span class="line">          "first-name": "jike",</span><br><span class="line">          "last-name": "shijian"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="index"><a href="#index" class="headerlink" title="index"></a>index</h3><ul>
<li>控制当前字段是否索引, 默认为true, 即记录索引, false不记录, 即不可搜索</li>
<li>设置为false的情况:<ul>
<li>该字段为敏感字段, 不想通过搜索进行该字段的检索</li>
<li>为了节省磁盘, 内存, 因为不索引当前字段, 即不对该字段进行倒排索引, 即可节省磁盘空间</li>
</ul>
</li>
</ul>
<p>示例:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> index使用示例</span></span><br><span class="line">PUT test_index5</span><br><span class="line">&#123;</span><br><span class="line">  "mappings": &#123;</span><br><span class="line">    "doc": &#123;</span><br><span class="line">      "properties": &#123;</span><br><span class="line">        "cookie": &#123;</span><br><span class="line">          "type": "text",	</span><br><span class="line">          "index": false		# 不对该字段进行索引</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为了验证设置为<span class="string">"index"</span>: <span class="literal">false</span> 的字段不能进行查询, 我们为test_index5新增一个文档</span></span><br><span class="line">PUT test_index5/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  "cookie": "user-agent..."</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看test_index5的所有文档信息</span></span><br><span class="line">GET test_index5/_search</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可见该文档已被插入</span></span><br><span class="line">&#123;</span><br><span class="line">  "took": 4,</span><br><span class="line">  "timed_out": false,</span><br><span class="line">  "_shards": &#123;</span><br><span class="line">    "total": 5,</span><br><span class="line">    "successful": 5,</span><br><span class="line">    "skipped": 0,</span><br><span class="line">    "failed": 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits": &#123;</span><br><span class="line">    "total": 1,</span><br><span class="line">    "max_score": 1,</span><br><span class="line">    "hits": [</span><br><span class="line">      &#123;</span><br><span class="line">        "_index": "test_index5",</span><br><span class="line">        "_type": "doc",</span><br><span class="line">        "_id": "1",</span><br><span class="line">        "_score": 1,</span><br><span class="line">        "_source": &#123;</span><br><span class="line">          "cookie": "user-agent..."</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据cookie字段(<span class="string">"index"</span>设置为了<span class="literal">false</span>)对test_index5索引进行查询</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由结果可知, 该查询发生错误, 错误原因(Cannot search on field [cookie] since it is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> indexed.)</span></span><br><span class="line">&#123;</span><br><span class="line">  "error": &#123;</span><br><span class="line">    "root_cause": [</span><br><span class="line">      &#123;</span><br><span class="line">        "type": "query_shard_exception",</span><br><span class="line">        "reason": "failed to create query: &#123;\n  \"match\" : &#123;\n    \"cookie\" : &#123;\n      \"query\" : \"user\",\n      \"operator\" : \"OR\",\n      \"prefix_length\" : 0,\n      \"max_expansions\" : 50,\n      \"fuzzy_transpositions\" : true,\n      \"lenient\" : false,\n      \"zero_terms_query\" : \"NONE\",\n      \"auto_generate_synonyms_phrase_query\" : true,\n      \"boost\" : 1.0\n    &#125;\n  &#125;\n&#125;",</span><br><span class="line">        "index_uuid": "aBw3JkTQT7aA8Oa8Y3i6VA",</span><br><span class="line">        "index": "test_index5"</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    "type": "search_phase_execution_exception",</span><br><span class="line">    "reason": "all shards failed",</span><br><span class="line">    "phase": "query",</span><br><span class="line">    "grouped": true,</span><br><span class="line">    "failed_shards": [</span><br><span class="line">      &#123;</span><br><span class="line">        "shard": 0,</span><br><span class="line">        "index": "test_index5",</span><br><span class="line">        "node": "Eyro1LLhQOSsyBQNJV86kQ",</span><br><span class="line">        "reason": &#123;</span><br><span class="line">          "type": "query_shard_exception",</span><br><span class="line">          "reason": "failed to create query: &#123;\n  \"match\" : &#123;\n    \"cookie\" : &#123;\n      \"query\" : \"user\",\n      \"operator\" : \"OR\",\n      \"prefix_length\" : 0,\n      \"max_expansions\" : 50,\n      \"fuzzy_transpositions\" : true,\n      \"lenient\" : false,\n      \"zero_terms_query\" : \"NONE\",\n      \"auto_generate_synonyms_phrase_query\" : true,\n      \"boost\" : 1.0\n    &#125;\n  &#125;\n&#125;",</span><br><span class="line">          "index_uuid": "aBw3JkTQT7aA8Oa8Y3i6VA",</span><br><span class="line">          "index": "test_index5",</span><br><span class="line">          "caused_by": &#123;</span><br><span class="line">            "type": "illegal_argument_exception",</span><br><span class="line">            "reason": "Cannot search on field [cookie] since it is not indexed."</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  "status": 400</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="index-options"><a href="#index-options" class="headerlink" title="index_options"></a>index_options</h3><ul>
<li>index_options用于控制倒排索引记录的内容, 有如下4中配置<ul>
<li>docs 只记录doc id</li>
<li>freqs 记录doc id 和 term frequencies</li>
<li>positions 记录 doc id , term frequencies 和 term position</li>
<li>offsets 记录 doc id , term frequencies , term position 和character offsets</li>
</ul>
</li>
<li>text类型默认配置为positions, 其他默认为docs</li>
<li>记录内容越多, 占用空间越大</li>
</ul>
<p>示例:</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/mkyhdsTu5P8x7QX.jpg"  alt="2020-04-09_015550" style="zoom:50%;" />

<h3 id="null-value"><a href="#null-value" class="headerlink" title="null_value"></a>null_value</h3><ul>
<li>当字段遇到null值时的处理策略, 默认为null, 即空值, 此时es会忽略该值, 可以通过设定该值设定字段的默认值.</li>
</ul>
<p>示例:</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/YBMlvsygLCVEDqX.jpg"  alt="2020-04-09_015811" style="zoom:50%;" />

<h3 id="mapping文档说明"><a href="#mapping文档说明" class="headerlink" title="mapping文档说明"></a>mapping文档说明</h3><ul>
<li><p>具体自定义mapping参数信息详见es官方文档</p>
<p>链接地址: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/mapping.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.1/mapping.html</a></p>
</li>
</ul>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="核心数据类型"><a href="#核心数据类型" class="headerlink" title="核心数据类型"></a>核心数据类型</h3><ul>
<li>字符串型    text, keyword</li>
<li>数值型        long, integer, short, byte, double, float, half_float, scaled_float</li>
<li>日期类型    date</li>
<li>布尔类型    boolean</li>
<li>二进制类型binary</li>
<li>范围类型    integer_range, float_range, long_range, double_range, date_range</li>
</ul>
<h3 id="复杂数据类型"><a href="#复杂数据类型" class="headerlink" title="复杂数据类型"></a>复杂数据类型</h3><ul>
<li>数组类型 array</li>
<li>对象类型 object</li>
<li>嵌套类型 nested object</li>
</ul>
<h3 id="地理位置数据类型"><a href="#地理位置数据类型" class="headerlink" title="地理位置数据类型"></a>地理位置数据类型</h3><ul>
<li>geo_point</li>
<li>geo_shape</li>
</ul>
<h3 id="专用类型"><a href="#专用类型" class="headerlink" title="专用类型"></a>专用类型</h3><ul>
<li>记录ip地址 ip</li>
<li>实现自动补全 completion</li>
<li>记录分词数 token_count</li>
<li>记录字符串hash 值 nurmur3</li>
<li>percolator</li>
<li>join</li>
</ul>
<h3 id="多字段特性"><a href="#多字段特性" class="headerlink" title="多字段特性"></a>多字段特性</h3><ul>
<li><p>允许对同一个字段采用不同的配置, 比如分词, 常见例子如对人名实现拼音搜索, 只需在人名中新增一个子字段为pinyin即可</p>
<p>示例:</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/5pVuh8KlTxLCWtm.jpg"  alt="2020-04-09_021610"/>



</li>
</ul>
<h2 id="Dynamic-Mapping"><a href="#Dynamic-Mapping" class="headerlink" title="Dynamic Mapping"></a>Dynamic Mapping</h2><ul>
<li><p>es可以自动识别文档字段类型, 从而降低用户使用成本, 如下所示:</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/Kois6vDTxHzRVnp.jpg"  alt="2020-04-09_022329"/>

</li>
</ul>
<h3 id="自动识别支持类型"><a href="#自动识别支持类型" class="headerlink" title="自动识别支持类型"></a>自动识别支持类型</h3><ul>
<li><p>es是依靠JSON文档的字段类型来实现自动识别字段类型, 支持的类型如下:</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/3hSOnUim6KMEcs8.jpg"  alt="2020-04-09_022510"/>
</li>
<li><p>验证es的自动识别</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/nMUbJIcdS6Lql8D.jpg"  alt="2020-04-09_022619"/>

</li>
</ul>
<h3 id="日期的自动识别"><a href="#日期的自动识别" class="headerlink" title="日期的自动识别"></a>日期的自动识别</h3><ul>
<li><p>日期的自动识别可以自行配置日期格式, 以满足各种需求</p>
<ul>
<li>默认是 [“strict_date_optional_time”, “yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z”]</li>
<li>strict_date_optional_time 是ISO datetime的格式, 完整格式类似下面:<ul>
<li>YYYY-MM-DDThh:mm:ssTZD (eg: 1997-07-16T19:20:30+01:00)</li>
</ul>
</li>
<li>dynamic_date_formats可以自定义日期类型</li>
<li>date_detection 可以关闭日期自动识别的机制</li>
</ul>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/HLjDvQ8wdKp96yk.jpg"  alt="2020-04-09_023652"></p>
</li>
</ul>
<h3 id="字符串中数字的自动识别"><a href="#字符串中数字的自动识别" class="headerlink" title="字符串中数字的自动识别"></a>字符串中数字的自动识别</h3><ul>
<li><p>字符串是数字时, 默认不会自动识别为整型, 因为字符串出现数字是完全合理的</p>
<ul>
<li><p>numeric_detection可以开启字符串中数字的自动识别, 如下所示:</p>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/W7eNK9hv2PrzAyb.jpg"  alt="2020-04-09_023901"></p>
</li>
</ul>
</li>
</ul>
<h2 id="Dynamic-Templates"><a href="#Dynamic-Templates" class="headerlink" title="Dynamic Templates"></a>Dynamic Templates</h2><ul>
<li><p>允许根据es自动识别的数据类型, 字段名等来动态设定字段类型, 可以实现如下效果:</p>
<ul>
<li>所有字符串类型都设定为keyword类型, 即默认不分词</li>
<li>所有以message开头的字段都设定为text类型, 即分词</li>
<li>所有以long_开头的字段都设定为long类型</li>
<li>所有自动匹配为double类型的都设定为float类型, 以节省空间</li>
</ul>
</li>
<li><p>Dynamic Templates API</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/qngQLkRxJEy6Sz9.jpg"  alt="2020-04-09_025126" style="zoom:67%;" />
</li>
<li><p>匹配规则一般有如下几个参数:</p>
<ul>
<li>match_mapping_type 匹配es自动识别的字段类型, 如boolean, long, string等</li>
<li>match, unmatch 匹配字段名</li>
<li>path_match, path_unmatch匹配路径</li>
</ul>
</li>
</ul>
<h3 id="Dynamic-Templates-设置示例"><a href="#Dynamic-Templates-设置示例" class="headerlink" title="Dynamic Templates 设置示例"></a>Dynamic Templates 设置示例</h3><ol>
<li><p>字符串默认使用keyword类型</p>
<ul>
<li>es默认会为字符串设置为text类型, 并增加一个keyword的子字段</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过设置dynamic_templates, 使字符串默认使用keyword类型</span></span><br><span class="line">PUT test_index6</span><br><span class="line">&#123;</span><br><span class="line">  "mappings": &#123;</span><br><span class="line">    "doc": &#123;</span><br><span class="line">      "dynamic_templates": [</span><br><span class="line">        &#123;</span><br><span class="line">          "string_as_keyword": &#123;</span><br><span class="line">            "match_mapping_type": "string", # 匹配string类型</span><br><span class="line">            "mapping": &#123;</span><br><span class="line">              "type": "keyword"		# 把string类型映射为keyword类型, 而不是默认的text</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 向test_index6索引添加文档, 以验证dynamic_templates配置</span></span><br><span class="line">PUT test_index6/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  "user": "jiavg"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获得es的Dynamic Mapping机制的默认识别类型</span></span><br><span class="line">GET test_index6/_mapping</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> response</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 由此可见, user被Dynamic Mapping机制识别为keyword, 而不是默认的text, 可见dynamic_templates配置生效</span></span><br><span class="line">&#123;</span><br><span class="line">  "test_index6": &#123;</span><br><span class="line">    "mappings": &#123;</span><br><span class="line">      "doc": &#123;</span><br><span class="line">        "dynamic_templates": [</span><br><span class="line">          &#123;</span><br><span class="line">            "string_as_keyword": &#123;</span><br><span class="line">              "match_mapping_type": "string",</span><br><span class="line">              "mapping": &#123;</span><br><span class="line">                "type": "keyword"</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        "properties": &#123;</span><br><span class="line">          "user": &#123;</span><br><span class="line">            "type": "keyword"</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>以message开头的字段设置为text类型</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/yHneTpSx8ojV67k.jpg"  alt="2020-04-09_030628" style="zoom:80%;" />
</li>
<li><p>double类型设置为float, 节省空间</p>
<img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/ne9cFyOtD7MmTj1.jpg"  alt="2020-04-09_030739" style="zoom:80%;" />



</li>
</ol>
<h2 id="自定义Mapping建议"><a href="#自定义Mapping建议" class="headerlink" title="自定义Mapping建议"></a>自定义Mapping建议</h2><ul>
<li>自定义Mapping的操作步骤如下<ul>
<li>写入一条文档到es的临时索引中, 获取es自动生成的mapping</li>
<li>修改步骤1得到的mapping, 自定义相关配置</li>
<li>使用步骤2的mapping创建实际所需索引</li>
</ul>
</li>
</ul>
<h2 id="索引模板"><a href="#索引模板" class="headerlink" title="索引模板"></a>索引模板</h2><ul>
<li><p>索引模板, 英文名为Index Template, 主要用于在新建索引时自动应用预先设定的配置, 简化索引创建的操作步骤</p>
<ul>
<li>可以设定索引的配置和mapping</li>
<li>可以有多个模板, 根据order设置, order大的覆盖小的配置</li>
</ul>
</li>
<li><p>索引模板API, endpoint为<code>_template</code>, 如下所示:</p>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/5TK8Flv4QnNVqbc.jpg"  alt="2020-04-09_032356"></p>
</li>
</ul>
<p>示例:</p>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/onVaWKDgwI4Y2t3.jpg"  alt="2020-04-09_032445"></p>
<ul>
<li><p>获取与删除的API如下:</p>
<p><img src="/" class="lazyload" data-src="https://i.loli.net/2020/04/12/pmg5nGNWxQRwuHU.jpg"  alt="2020-04-09_032534"></p>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Jiavg</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jiavag.github.io/2020/04/09/Elastic%20Search/%E7%AC%AC4%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BMapping%E8%AE%BE%E7%BD%AE/">https://jiavag.github.io/2020/04/09/Elastic%20Search/%E7%AC%AC4%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BMapping%E8%AE%BE%E7%BD%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jiavag.github.io" target="_blank">Jiavg</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a><a class="post-meta__tags" href="/tags/Mapping/">Mapping</a></div><div class="post_share"><div class="social-share" data-image="/img/bg/13.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.png" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/09/Elastic%20Search/%E7%AC%AC5%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8BSearch%20API/"><img class="prev_cover lazyload" data-src="/img/bg/6.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Elasticsearch篇之Search API</div></div></a></div><div class="next-post pull_right"><a href="/2020/04/08/Elastic%20Search/%E7%AC%AC3%E7%AB%A0-Elasticsearch%E7%AF%87%E4%B9%8B%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%88%86%E8%AF%8D/"><img class="next_cover lazyload" data-src="/img/bg/20.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Elasticsearch篇之倒排索引与分词</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/16/Elastic Search/第10章-Elasticsearch篇之集群调优建议/" title="Elasticsearch篇之集群调优建议"><img class="relatedPosts_cover lazyload"data-src="/img/bg/13.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-16</div><div class="relatedPosts_title">Elasticsearch篇之集群调优建议</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/04/Elastic Search/4.案例实战/" title="实战-分析Elasticsearch 查询语句"><img class="relatedPosts_cover lazyload"data-src="/img/bg/12.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-04</div><div class="relatedPosts_title">实战-分析Elasticsearch 查询语句</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/01/Elastic Search/1.ElasticSearch与Kibana/" title="ElasticSearch与Kibana入门"><img class="relatedPosts_cover lazyload"data-src="/img/bg/7.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-01</div><div class="relatedPosts_title">ElasticSearch与Kibana入门</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/11/Elastic Search/第6章-Elasticsearch篇之分布式特性/" title="Elasticsearch篇之分布式特性"><img class="relatedPosts_cover lazyload"data-src="/img/bg/6.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-11</div><div class="relatedPosts_title">Elasticsearch篇之分布式特性</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/08/Elastic Search/第3章-Elasticsearch篇之倒排索引与分词/" title="Elasticsearch篇之倒排索引与分词"><img class="relatedPosts_cover lazyload"data-src="/img/bg/20.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-08</div><div class="relatedPosts_title">Elasticsearch篇之倒排索引与分词</div></div></a></div><div class="relatedPosts_item"><a href="/2020/04/09/Elastic Search/第5章-Elasticsearch篇之Search API/" title="Elasticsearch篇之Search API"><img class="relatedPosts_cover lazyload"data-src="/img/bg/6.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-04-09</div><div class="relatedPosts_title">Elasticsearch篇之Search API</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Jiavg</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>